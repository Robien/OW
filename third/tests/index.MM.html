<script src="http://cdn.peerjs.com/0.3/peer.js"></script>
<script src="./connection.js"></script>


<input type="text" id="peerID" /> <input type="button" OnClick="javascript:connect()" />
<br />
<input type="text" id="OPeerID" /> <input type="button" OnClick="javascript:connectToPeer()" />

<div id="res">
</div>

<script>

var peer;


function connect()
{
peer = new Peer(document.getElementById("peerID").value, {host: '192.168.1.23', port: 9000, path: '/'});
peer.on('connection', function(conn) {
  conn.on('data', function(data){
    // Will print 'hi!'
   buffStr = data.split(",");

var message = new proto.Connection.ConnectionMessageServer();

message = proto.Connection.ConnectionMessageServer.deserializeBinary(buffStr);

if (message.getType() == proto.Connection.ConnectionMessageServer.ConnectionMessageTypeServer.ACK_MATCH_MAKING)
{
	document.getElementById("res").innerHTML += "ack MM : " + message.getAckmm().getIsok() + "<br />";
}
else if (message.getType() == proto.Connection.ConnectionMessageServer.ConnectionMessageTypeServer.MATCH_FOUND)
{
	document.getElementById("res").innerHTML += "MF : is main = " + message.getStartgame().getIsmain()  + " other name: " + message.getStartgame().getChallengedname()  + " <br />";
}
else
{
	document.getElementById("res").innerHTML += "other message received <br />";
}

  });
});
}

function connectToPeer()
{
var conn = peer.connect("server");
conn.serialization='none';
conn.on('open', function(){


var message = new proto.Connection.ConnectionMessageClient();

message.setType(proto.Connection.ConnectionMessageClient.ConnectionMessageTypeClient.START_MATCH_MAKING);

var smm = new proto.Connection.StartMatchMaking();

smm.setElo(0);
smm.setMyname(document.getElementById("peerID").value);
smm.setChallengedname("");

message.setStartmatchmaking(smm);

// Serializes to a UInt8Array.
bytes = message.serializeBinary();
//console.log('message len :' + bytes.length);
//console.log('message :' + bytes.toString());



//alert(bytes.length);
//alert(bytes.join());

conn.send(bytes.join());

//  conn.send('hi!');
});


}

</script>
